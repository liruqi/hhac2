<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Movie Directory</title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <title>Movies: <%= controller.action_name %></title>
  <%= javascript_include_tag "prototype" %>
  <%= stylesheet_link_tag 'scaffold' %>
  <%= stylesheet_link_tag 'hhac' %>
  <script type="text/javascript">
function render_ajaxCon_for_xlogin()
{
  state = $("ajaxCon").getAttribute("state");
  if (state == "empty")
  {
    new Ajax.Updater("ajaxCon", "/login/xlogin", {
      method:"get", evalScript:true, asynchronous:false});
    $("ajaxCon").setAttribute("state", "nonempty");
  }
  else
  {
    while(child = $("ajaxCon").firstChild)
      $("ajaxCon").removeChild(child);
    $("ajaxCon").setAttribute("state", "empty");
  }
}
  </script>

</head>

<body>
  <div id="page">
    <div id="header">
      <h1>Home of Harmless Amination & Comic</h1>
    </div>

    <div id="content">
      <div id="nav">
        <ul>
          <li><a href="/movies">Movies</a></li>
<% user = current_user %>
<% if user && user.privilege > 1 %>
          <li><a href="/comments">Comments</a></li>
<% end %>
        </ul>

        <!--
        div `login-info` 在导航栏右端显示用户登录信息
          如果没有登录，则给出 Login 和 Register 链接
          如果已经登录，则给出 uname 和 Logout 链接
        -->
<% if user && user.privilege > 1 %>
        <div id="login-info">
<% else %>
        <div id="login-info" style="position:relative;left:750px">
<% end %>
<% if user %>
<li><%= link_to user.uname, :controller => :users, :action => :show, :id => user.id %></li>
<li><%= link_to "Logout", "/login/logout" %></li>
<% else %>
<li><%= link_to "Login", "/login/index" %>
<li><%= link_to "Register", :controller => :users, :action => :new %></li>
<% end %>
        </div>

      </div>
      <div id="main">
        <div id="left">
          <p style="color:green"><%= flash[:notice] %></p>

          <%= yield %>

        </div>
        <div id="right">
          <div id="ajaxCon" state="empty">
          </div>
        </div>
      </div>
    </div>

    <div id="footer">
      <p>Copyrighted by physacco@gmail.com, 2009</p>
    </div>
  </div>
</body>
</html>
